<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Mars Rover Problem</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="bfs.js"></script> 
        <script src="astar.js"></script> 
        <script src="dijkstra's.js"></script> 
        <link rel="stylesheet" href="style.css">
    </head>
    <body >
        <div class="grid-container">
            <canvas id="my_grid"></canvas>
        </div>
        <div class="controls_panel ">
            <div class="hide_n_seek" onclick="hide_seek()"><i class="fa fa-angle-double-up" aria-hidden="true"></i></div>
            <div class="select_algo">Select Algorithm</div>
            <div class="controls_panel_con">
                <div class="bfs_panel">
                    <div class="bfs_search" onclick="startSearch('DFS')">
                        <i class="fa fa-arrow-right" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Breadth First Search
                    </div>
                    <div class="bfs_options_title">Options</div>
                    <div class="bfs_search_opts">
                        <input id="bfs_diagonal" type="checkbox">&nbsp;
                        <label for="bfs_diagonal">Allow Diagonal</label>
                    </div>
                </div>
                <div class="astar_panel" >
                    <div class="astar_search" onclick="startSearch('AStar')">
                        <i class="fa fa-arrow-right" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;A Star
                    </div>
                    <div class="astar_heuristic_title">Heuristic</div>
                    <div class="astar_search_heu">
                        <input id="astar_manhattann" type="checkbox">&nbsp;
                        <label for="astar_manhattan">Manhattan</label>
                    </div>
                    <div class="astar_options_title">Options</div>
                    <div class="astar_search_opts">
                        <input id="astar_diagonal" type="checkbox">&nbsp;
                        <label for="astar_diagonal">Allow Diagonal</label>
                    </div>
                </div>
                <div class="dijkstra_panel">
                    <div class="dijkstra_search" onclick="startSearch('Dijkstra')">
                        <i class="fa fa-arrow-right" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Dijkstra Search
                    </div>
                    <div class="dijkstra_options_title">Options</div>
                    <div class="dijkstra_search_opts">
                        <input id="dijkstra_diagonal" type="checkbox">&nbsp;
                        <label for="dijkstra_diagonal">Allow Diagonal</label>
                    </div>
                </div> 
                <button class="btn btn-success" onclick="startSearch()">start search</button>
                <button class="btn btn-success" onclick="clearWalls()">clear walls</button>   
            </div>
            </div>
        <script> 
            $(document).ready(function() {
                
            });
            var hide_n_seek = false;
            function hide_seek(){
                if(!hide_n_seek){
                    hide_n_seek = true;
                    $('.controls_panel_con').css('max-height', '500px');
                    $('.hide_n_seek .fa').removeClass('fa-angle-double-up');
                    $('.hide_n_seek .fa').addClass('fa-angle-double-down');
                    $('.controls_panel_con').css('transition', 'all 0.5s ease-in-out');
                }
                else{
                    hide_n_seek = false;
                    $('.controls_panel_con').css('max-height', '0px');
                    $('.hide_n_seek .fa').removeClass('fa-angle-double-down');
                    $('.hide_n_seek .fa').addClass('fa-angle-double-up');
                    $('.controls_panel_con').css('transition', 'all 0.5s ease-in-out');
                }
            }

            var search_mode = "DFS";
            var node_map = new Map();
            var explored_node = new Map(); 
            var w = 1920;
            var h = 1080;
            var s_node = [17, 20];
            var e_node = [17, 30];
            var prev_node = [-100, -100];
            var h_count = 0;
            // grid step
            var step = 30; 
            var finalPath;
            var canvasElementId = 'my_grid';
            var canvas = document.getElementById(canvasElementId);
            canvas.addEventListener('click', handleClick);
            canvas.ondragstart = function() {
                return false;
            };

         // this is how you resize the canvas
            canvas.width  = w;
            canvas.height = h;

            var ctx = canvas.getContext('2d');

            function initialize_s_e_nodes(){
                var y1 = s_node[0], x1 = s_node[1], y2 = e_node[0], x2 = e_node[1];
                ctx.fillStyle = "green";
                ctx.fillRect(x1 * step,y1 * step, step, step);
                ctx.strokeStyle = "grey";
                ctx.strokeRect(x1* step, y1 * step, step, step);

                ctx.fillStyle = "red";
                ctx.fillRect(x2 * step,
                        y2* step, step, step);
                ctx.strokeStyle = "grey";
                ctx.strokeRect(x2 * step,y2 * step, step, step);
            }

            var drawGrid = function(ctx, w, h, step) {
                ctx.beginPath(); 
                for (var x = 0; x <= w; x += step) {
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, h);
                }
                ctx.strokeStyle = 'grey';
                ctx.lineWidth = 1;
                ctx.stroke(); 

                ctx.beginPath(); 
                for (var y = 0; y <= h; y += step) {
                        ctx.moveTo(0, y);
                        ctx.lineTo(w, y);
                }
                ctx.strokeStyle = 'grey';
                ctx.lineWidth = 1;
                ctx.stroke(); 
                initialize_s_e_nodes();
            };

            function move_start_end(x, y, mode){
                var row, col;
                col = Math.floor(x / step);
                row = Math.floor(y / step);
                
                switch(mode){
                    case 1:
                        console.log("start_block drag ");
                        prev_node[0] = s_node[0];
                        prev_node[1] = s_node[1];
                        s_node[0] = row;
                        s_node[1] = col;

                        //color previous node as white
                        ctx.fillStyle = "white";
                        ctx.fillRect(prev_node[1] * step, prev_node[0]* step, step, step);
                        ctx.strokeStyle = "white";
                        ctx.strokeRect(prev_node[1] * step, prev_node[0]* step, step, step);
                        ctx.strokeStyle = "grey";
                        ctx.strokeRect(prev_node[1] * step, prev_node[0]* step, step, step);

                        //color current node
                        ctx.fillStyle = "green";
                        ctx.fillRect(s_node[1] * step, s_node[0]* step, step, step);
                        ctx.strokeStyle = "white";
                        ctx.strokeRect(s_node[1] * step, s_node[0]* step, step, step);
                        ctx.strokeStyle = "grey";
                        ctx.strokeRect(s_node[1] * step, s_node[0]* step, step, step);
                        console.log("done my task");
                        break;
                    case 2:
                        console.log("end_block drag ");
                        prev_node[0] = e_node[0];
                        prev_node[1] = e_node[1];
                        e_node[0] = row;
                        e_node[1] = col;

                        //color previous node as white
                        ctx.fillStyle = "white";
                        ctx.fillRect(prev_node[1] * step, prev_node[0]* step, step, step);
                        ctx.strokeStyle = "white";
                        ctx.strokeRect(prev_node[1] * step, prev_node[0]* step, step, step);
                        ctx.strokeStyle = "grey";
                        ctx.strokeRect(prev_node[1] * step, prev_node[0]* step, step, step);

                        //color current node
                        ctx.fillStyle = "red";
                        ctx.fillRect(e_node[1] * step, e_node[0]* step, step, step);
                        ctx.strokeStyle = "white";
                        ctx.strokeRect(e_node[1] * step, e_node[0]* step, step, step);
                        ctx.strokeStyle = "grey";
                        ctx.strokeRect(e_node[1] * step, e_node[0]* step, step, step);
                        console.log("done my task");
                        break;
                }
            }
            function clearWalls(){
                node_map.clear();
                explored_node.clear();
                ctx.clearRect(0, 0, w, h);
                drawGrid(ctx, w, h, step);
            }

            function colorBlock(x, y, mode){
                var row, col;
                col = Math.floor(x / step);
                row = Math.floor(y / step);
                if((col == s_node[1] && row == s_node[0]) || (col == e_node[1] && row == e_node[0])) return;
                switch(mode){
                    case 1:
                        if(!node_map.has(row + "" + col) ){
                            if(explored_node.has(row + "" + col)){
                                ctx.fillStyle = "white"; 
                                ctx.fillRect(Math.floor(x / step) * step,
                                Math.floor(y / step) * step, step, step)
                            }
                            ctx.fillStyle = "rgba(160, 82, 45, 0.5)";
                            console.log("pehli baar click hua ", row, col);
                            node_map.set(row + "" +  col , true);    
                        }
                        else if(node_map.has(row + "" + col)){
                            console.log("doosri baar click hua");
                            if(explored_node.has(row + "" + col)){
                                ctx.fillStyle = "skyblue"; 
                                ctx.fillRect(Math.floor(x / step) * step,
                                Math.floor(y / step) * step, step, step);
                                ctx.strokeStyle = "grey";
                                ctx.strokeRect(Math.floor(x / step) * step,Math.floor(y / step) * step, step, step);
                                printPath(finalPath);
                            }
                            else{
                                ctx.fillStyle = "white"; 
                                ctx.fillRect(Math.floor(x / step) * step,
                                Math.floor(y / step) * step, step, step);
                                ctx.strokeStyle = "grey";
                                ctx.strokeRect(Math.floor(x / step) * step,Math.floor(y / step) * step, step, step);
                            }
                            node_map.delete(row + "" + col);
                        }
                        break;
                    case 2:
                        if(!node_map.has(row + "" + col) ){
                            h_count++;
                            ctx.fillStyle = "rgba(160, 82, 45, 0.5)";
                            node_map.set(row + "" +  col , true);    
                            ctx.fillRect(Math.floor(x / step) * step,
                            Math.floor(y / step) * step, step, step);
                        }
                        ctx.strokeStyle = "grey";
                        ctx.strokeRect(Math.floor(x / step) * step,Math.floor(y / step) * step, step, step);
                        break;
                }
            }
            function colorExploredPath(y, x){
                if(!explored_node.has(y + "" + x)){
                    console.log('color explored path ', y, " ",x);
                    if(y == s_node[0] && x == s_node[1]) return;
                    ctx.fillStyle = "skyblue";
                    ctx.fillRect(x * step,y * step, step, step);
                    ctx.strokeStyle = "grey";
                    ctx.strokeRect(x* step, y * step, step, step);
                    explored_node.set(y + "" +  x , true);    
                }  
            }

            function printPath(finalpath){
                finalPath = finalpath;
                for(var i = 1; i < finalpath.length; i++)
                {   ctx.beginPath();
                    ctx.moveTo(s_node[1] * step + step/2, s_node[0] * step + step/2);
                    ctx.lineTo(finalpath[0][1] * step + step/2, finalpath[0][0] * step + step/2);
                    ctx.lineWidth = 2;
                    ctx.strokeStyle = "yellow";
                    ctx.stroke(); 
                    console.log(finalpath[i][0] + " " + finalpath[i][1] + " ");
                    ctx.beginPath();
                    ctx.moveTo(finalpath[i - 1][1] * step + step/2, finalpath[i - 1][0] * step + step/2);
                    ctx.lineTo(finalpath[i][1] * step + step/2, finalpath[i][0] * step + step/2);
                    ctx.lineWidth = 2;
                    ctx.strokeStyle = "yellow";
                    ctx.stroke(); 
                }
                console.log('print path completed');
            }
            function handleClick(e) {
                console.log('click hua');
                colorBlock(e.offsetX, e.offsetY, 1);
            }

            canvas.onmousedown = function(event) {
                var h_count = 0;
                var flag = 0;
                console.log("it is down");
                var col = Math.floor(event.pageX / step);
                var row = Math.floor(event.pageY / step);
                if(col == s_node[1] && row == s_node[0]){
                    flag = 1;
                }
                else if(col == e_node[1] && row == e_node[0]) {
                   flag = 2;
                }
                // centers thecanvas at (pageX, pageY) coordinates
                function moveAt(pageX, pageY) {
                    console.log(pageX, "  ", pageY);
                
                }

                function onMouseMove(event) {
                    h_count++;
                    var col = Math.floor(event.pageX / step);
                    var row = Math.floor(event.pageY / step);
                    console.log(row , "  ", col);
                    if(!node_map.has(row + "" + col) && (flag == 1 || flag == 2)){
                        if(flag == 1)
                            move_start_end(event.pageX, event.pageY, flag);
                        else if(flag == 2) 
                            move_start_end(event.pageX, event.pageY, flag);
                    }
                    else
                        colorBlock(event.pageX, event.pageY, 2);
                }

                // (2) move thecanvas on mousemove
                document.addEventListener('mousemove', onMouseMove);

                // (3) drop thecanvas, remove unneeded handlers
                canvas.onmouseup = function() {
                    document.removeEventListener('mousemove', onMouseMove);
                    if(h_count > 1){
                        window.addEventListener(
                            'click',
                            captureClick,
                            true // <-- This registeres this listener for the capture
                                //     phase instead of the bubbling phase!
                        ); 
                    }
                    canvas.onmouseup = null;
                };
            };

            function captureClick(e) {
                console.log('click captured');
                e.stopPropagation(); // Stop the click from being propagated.
                window.removeEventListener('click', captureClick, true); // cleanup
            }
            //Algos part on user selection
           

            function startSearch(m){
                search_mode = m;
                finalPath = [[]];
                explored_node.clear();
                switch(search_mode){
                    case "DFS":
                       // console.log("something to DO");
                        startDFSSearch(s_node, e_node, node_map);
                        break;
                    case "AStar":
                        startAStarSearch(s_node, e_node, node_map);
                        break;
                    case "Dijkstra":
                        startDjikstra(s_node, e_node, node_map);
                        break;
                }
            }
            drawGrid(ctx, w, h, step);
        </script>
    </body>
</html>